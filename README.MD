# Сервис микроблогов на FastAPI
![](/data/app_screen.png "Main page screen")

## Краткое описание проекта
Корпоративный сервис микроблогов (~~Tweeter~~) представляет из себя приложение, бэкенд которого написан на одном из самых быстрых фреймворков - **FastAPI**.
___
### Сервис позволяет пользователям совершать следующие операции:
- добавление/удаление твитов, в том числе с медиа
- подписка/отписка от других пользователей
- отмечать твиты как понравившиеся / убирать отметку "Нравится"
- получение ленты твитов
- получение информации о пользователях

## Структура проекта
```
python_advanced_diploma
├── alembic.ini
├── migrations/
├── nginx
│   └── nginx.conf
├── requierements
│  ├── requierements_dev.txt
│   └── requierements_prod.txt
├── src
│   ├── images
│   │   ├── exceptions.py
│   │   ├── models.py
│   │   ├── router.py
│   │   └── service.py
│   ├── likes
│   │   └── models.py
│   ├── tweets
│   │   ├── exceptions.py
│   │   ├── models.py
│   │   ├── router.py
│   │   ├── schemas.py
│   │   └── service.py
│   ├── users
│   │   ├── exceptions.py
│   │   ├── models.py
│   │   ├── router.py
│   │   ├── schemas.py
│   │   └── service.py
│   ├── utils/
│   ├── config.py
│   ├── database.py
│   ├── dependencies.py
│   ├── exceptions.py
│   ├── main.py
│   ├── static
│   │   ├── css/
│   │   ├── images/
│   │   ├── js/
│   │   └── index.html
│   ├── tests
│   │   ├── conftest.py
│   │   ├── test_api.py
│   │   └── docker-compose.yaml
├── .env
├── .gitignore
├── .env
├── docker-compose.yaml
├── Dockerfile
├── pytest.ini
├── README.MD
└── setup.cfg
```
### Стэк технологий
В проекте использовлся следующий стэк технологий:
- **FastAPI + Pydantic + Swagger**: асинхронный web-фреймворк с валидацией данных, основанной на типах данных, и автопостроением документации API
- **Postgres + ORM SQLAlchemy + Alembic**: работа с БД и миграциями
- **Pytest + linters**: unit-тесты и статическая проверка кода
- **NGINX**: веб-сервер, интеграция фронтенда, бэкенда и БД
- **Docker**: доставка и запуск контейнерных приложений

### Описание компонентов
1. ```/src``` - главная директория приложения **FastAPI**
    - ```main.py``` - точка входа в приложение
    - ```config.py``` - конфигурационный модуль с инициализацией переменных окружения
    - ```database.py``` - модуль с инициализацией имплементации БД Postgres - **ORM SQLAlchemy**
    - ```dependencies.py``` - модуль с зависимостями **FastAPI**
    - ```exceptions.py``` - модуль с основными кастомными исключениями
    - ```/images```, ```/likes```, ```/tweets```, ```/users``` - пакеты, объединяющие модули работы над конкретными сущностями приложения. Включают в себя модели **SQLAlchemy**, исключения, роуты, бизнес-логику, схемы **Pydantic**
    - ```/utils``` - пакет, содержащий вспомогательные функции
2. ```/migrations```, ```alembic.ini``` - включают в себя функционал библиотеки **Alembic** по ведению версионности структуры БД
3. ```/nginx``` - директория с конфигурацией сервера **NGINX**
4. ```/requiremets``` - директория с зависимостями проекта: для разработки и продакшна.
5. ```/static``` - директория со статическим контентом приложения
6. ```/tests``` - директория с unit-тестами на **pytest**
7. ```.env``` - файл с переменными окружения
8. ```pytest.ini``` - конфигурационный файл **pytest**
9. ```setup.cfg``` - конфигурационный файл линтеров
10. ```Dockerfile``` - файл-сборщик image **FastAPI**-приложения
11. ```docker-compose.yml``` - файл оркестрации **FastAPI**, **Postgres** и **NGINX**
12. ```README.MD``` - документация проекта

## Инструкция по запуску сервиса

### 1. Клонирование git-репозитория:
```python
$ git clone https://gitlab.skillbox.ru/vsevolod_kriazhev/python_advanced_diploma.git
```

### 2. Запуск unit-тестов:
- Установить dev-зависимости в созданное виртуальное окружение:
    ```python
    $ pip install -r requirements/requirements_dev.txt
    ```
- Перейти в каталог `/tests`
    ```python 
    $ cd tests
    ```
- Запустить тестовую БД Postgres:
    ```python 
    $ sudo docker compose up --buld
    ```
- Запустить тесты:
    ```python
    $ pytest -s -v

### 3. Запуск приложения:
- Перейти в директорию с `main.py` модулем:
    ```python
    $ cd ..
    ```
- Запустить контейнер с приложением:
    ```python
    $ sudo docker compose up --build
    ```
- Сервис доступен по URL http://127.0.0.1
- Документация API доступна по URL http://127.0.0.1/api/docs
- При стартовом запуске приложения в целях демонстрации основного функционала происходит добавление в БД двух пользователей с api-key `test` и `test2`, которые можно ввести на главной странице сайта.
## Заключение
Данный проект позволяет развернуть сервис корпоративных микроблогов с обслуживанием статических файлов через NGINX и хранением данных в реляционной базе данных СУБД Postgre SQL. Бэкэнд сервиса написан на современном высокопроизводительном фреймворке FastAPI. Используя Docker Compose, представляется возможным осуществлять перенос и запуск приложения при минимальных затратах.
